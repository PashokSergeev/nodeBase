<html lang="ru"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Менеджер видео</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
        }
        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .transition-fade {
            transition: opacity 0.5s ease;
        }
        .drag-over {
            background-color: rgb(99, 102, 241);
            border: 2px dashed #6366f1;
        }
        .video-thumbnail {
            width: 160px;
            height: 90px;
            background-color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            overflow: hidden;
        }
        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background-color: #ffffff;
        }
        .control-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(255, 255, 255, 0.7));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .control-overlay.visible {
            opacity: 1;
        }
        .audio-player {
            display: none;
        }
        .transition-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .audio-upload-area {
            border: 2px dashed #6366f1;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .audio-upload-area:hover {
            background-color: rgba(99, 102, 241, 0.1);
        }
        .audio-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            background-color: #f3f4f6;
        }
        .audio-item:hover {
            background-color: #e5e7eb;
        }
        .audio-item.selected {
            background-color: #dbeafe;
            border: 1px solid #93c5fd;
        }
        option:hover,
        option:focus,
        option:active,
        option:checked {
            background: linear-gradient(45deg, #0d7a93, #00a38c);
            color: white;
            font-weight: bold;
            border-radius: 5px;
        }

    </style>
    <style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.16 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.ml-2{margin-left:0.5rem}.mr-2{margin-right:0.5rem}.mt-1{margin-top:0.25rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-2{margin-top:0.5rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-4{height:1rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-2\.5{height:0.625rem}.h-5{height:1.25rem}.max-h-40{max-height:10rem}.min-h-screen{min-height:100vh}.w-4{width:1rem}.w-full{width:100%}.w-10{width:2.5rem}.w-12{width:3rem}.w-5{width:1.25rem}.flex-grow{flex-grow:1}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-6{gap:1.5rem}.gap-4{gap:1rem}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.rounded-full{border-radius:9999px}.rounded-l-md{border-top-left-radius:0.375rem;border-bottom-left-radius:0.375rem}.rounded-r-md{border-top-right-radius:0.375rem;border-bottom-right-radius:0.375rem}.border{border-width:1px}.border-2{border-width:2px}.border-dashed{border-style:dashed}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.bg-indigo-500{--tw-bg-opacity:1;background-color:rgb(99 102 241 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-indigo-700{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-600{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-opacity-20{--tw-bg-opacity:0.2}.p-2{padding:0.5rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.py-8{padding-top:2rem;padding-bottom:2rem}.text-center{text-align:center}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.backdrop-blur-sm{--tw-backdrop-blur:blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color, background-color, border-color, fill, stroke, opacity, box-shadow, transform, filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-text-decoration-color, -webkit-backdrop-filter;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:border-indigo-500:hover{--tw-border-opacity:1;border-color:rgb(99 102 241 / var(--tw-border-opacity, 1))}.hover\:bg-indigo-700:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-800:hover{--tw-bg-opacity:1;background-color:rgb(55 48 163 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-opacity-30:hover{--tw-bg-opacity:0.3}.focus\:ring-indigo-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(99 102 241 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 768px){.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.lg\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}}@media (min-width: 1280px){.xl\:grid-cols-5{grid-template-columns:repeat(5, minmax(0, 1fr))}}</style></head>
<body class="min-h-screen">
<div id="app" class="min-h-screen flex flex-col">
    <!-- Navigation -->
    <nav class="bg-indigo-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold">Менеджер видео</h1>
            <div class="flex space-x-4">
                <button id="viewModeBtn" class="px-4 py-2 rounded hover:bg-indigo-800 transition bg-indigo-500">Режим просмотра</button>
                <button id="adminModeBtn" class="px-4 py-2 rounded hover:bg-indigo-700 transition bg-indigo-700">Режим администратора</button>
            </div>
        </div>
    </nav>

    <!-- View Mode -->
    <div id="viewMode" class="hidden flex-grow flex-col">
        <div class="container mx-auto px-4 py-6 flex-grow flex flex-col">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">Настройки воспроизведения</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Скорость воспроизведения</label>
                        <div class="flex items-center">
                            <span class="mr-2 text-sm">0.5x</span>
                            <input type="range" id="speedSlider" min="0.5" max="2" step="0.1" value="1" class="w-full">
                            <span class="ml-2 text-sm">2x</span>
                        </div>
                        <div class="text-center mt-1">
                            <span id="speedValue" class="text-sm font-medium">1x</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Тип перехода</label>
                        <select id="transitionType" class="w-full p-2 border border-gray-300 rounded-md" size="10">
                            <option value="fade">Fade</option>
                            <option value="slide-left">Slide Left</option>
                            <option value="slide-right">Slide Right</option>
                            <option value="slide-up">Slide Up</option>
                            <option value="slide-down">Slide Down</option>
                            <option value="zoom-in">Zoom In</option>
                            <option value="zoom-out">Zoom Out</option>
                            <option value="rotate">Rotate</option>
                            <option value="flip">Flip</option>
                            <option value="none">Никакого перехода</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Циклическое воспроизведение</label>
                    <div class="flex items-center">
                        <input type="checkbox" id="loopPlayback" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="loopPlayback" class="ml-2 block text-sm text-gray-900">
                            Циклический видеоряд
                        </label>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Настройки звука</label>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center">
                            <input type="radio" id="useVideoAudio" name="audioSource" value="video" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300" checked="">
                            <label for="useVideoAudio" class="ml-2 block text-sm text-gray-900">
                                Используйте аудио из видео
                            </label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="useBackgroundMusic" name="audioSource" value="music" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                            <label for="useBackgroundMusic" class="ml-2 block text-sm text-gray-900">
                                Используйте фоновую музыку
                            </label>
                        </div>
                    </div>
                    <div id="backgroundMusicSelector" class="mt-3 hidden">
                        <select id="musicSelect" class="w-full p-2 border border-gray-300 rounded-md" size="5">
                            <option value="">Выберите фоновую музыку</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Active Group</label>
                    <select id="activeGroupSelect" class="w-full p-2 border border-gray-300 rounded-md" size="5">
                        <option value="">Выберите группу</option>
                    </select>
                </div>
                <div class="mt-6 flex justify-center">
                    <button id="startPlaybackBtn" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        Начать воспроизведение
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Player -->
    <div id="fullscreenPlayer" class="hidden">
        <div class="video-container">
            <div class="transition-container">
                <video id="videoPlayer" class="video-player" autoplay=""></video>
            </div>
            <audio id="audioPlayer" class="audio-player" loop=""></audio>
        </div>
        <div id="controlOverlay" class="control-overlay">
            <div class="flex justify-between items-center">
                <div>
                    <button id="toggleMuteBtn" class="px-4 py-2 bg-white bg-opacity-20 backdrop-blur-sm text-white rounded-full hover:bg-opacity-30 transition mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    <span id="currentVideoInfo" class="text-white text-sm"></span>
                </div>
                <button id="exitFullscreenBtn" class="px-4 py-2 bg-white bg-opacity-20 backdrop-blur-sm text-white rounded-full hover:bg-opacity-30 transition">
                    Выход из полноэкранного режима
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Mode -->
    <div id="adminMode" class="flex-grow flex flex-col">
        <div class="container mx-auto px-4 py-6 flex-grow">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Group Management -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Группы видео</h2>
                    <div class="mb-4">
                        <div class="flex">
                            <input type="text" id="newGroupName" placeholder="New group name" class="flex-grow p-2 border border-gray-300 rounded-l-md">
                            <button id="createGroupBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-r-md hover:bg-indigo-700 transition">
                                Создать
                            </button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Выберите группу</label>
                        <select id="groupSelect" class="w-full p-2 border border-gray-300 rounded-md" size="5">
                            <option value="">Выберите группу</option>
                        </select>
                    </div>
                    <div class="flex justify-between">
                        <button id="setActiveGroupBtn" class="px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                            Сделать активным
                        </button>
                        <button id="deleteGroupBtn" class="px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
                            Удалить группу
                        </button>
                    </div>
                </div>

                <!-- Video Upload -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Загрузка видео</h2>
                    <div id="uploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-indigo-500 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <p class="mt-2 text-sm text-gray-600">Перетащите видео сюда или нажмите, чтобы выбрать</p>
                        <input type="file" id="fileInput" class="hidden" accept="video/*" multiple="">
                    </div>
                    <div class="mt-4">
                        <div id="uploadProgress" class="hidden">
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="progressBar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                            <p id="uploadStatus" class="text-sm text-gray-600 mt-1">Загружено: 0%</p>
                        </div>
                    </div>
                </div>

                <!-- Music Upload -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Фоновая музыка</h2>
                    <div id="audioUploadArea" class="audio-upload-area mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                        </svg>
                        <p class="mt-2 text-sm text-gray-600">Перетащите сюда музыкальные файлы или нажмите, чтобы выбрать</p>
                        <input type="file" id="audioFileInput" class="hidden" accept="audio/*" multiple="">
                    </div>
                    <div id="audioUploadProgress" class="hidden mb-4">
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="audioProgressBar" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="audioUploadStatus" class="text-sm text-gray-600 mt-1">Загружено: 0%</p>
                    </div>
                    <div id="musicList" class="max-h-40 overflow-y-auto">
                        <!-- Music items will be added here -->
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="mt-6 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4">Управление данными</h2>
                <p class="text-sm text-gray-600 mb-4">Сохраните изменения в настройках вашей группы и видео.</p>
                <div class="flex space-x-4">
                    <button id="saveDataBtn" class="flex-grow px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
                        Сохранить данные на сервер
                    </button>
                    <button id="loadDataBtn" class="flex-grow px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition">
                        Загрузить сохраненные данные из сервера
                    </button>
                </div>
                <div id="saveStatus" class="mt-4 text-sm hidden"></div>
            </div>

            <!-- Video List -->
            <div id="videoListContainer" class="mt-6 bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4">Видео в группе: <span id="currentGroupName">Не выбран ни один из них</span></h2>
                <div id="noGroupSelected" class="text-center py-8 text-gray-500">
                    Выберите группу для отображения видеороликов
                </div>
                <div id="emptyGroupMessage" class="hidden text-center py-8 text-gray-500">
                    В этой группе пока нет видео. Загрузите видео, чтобы добавить их в группу.
                </div>
                <div id="videoList" class="hidden grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                    <!-- Videos will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // App state
        const appState = {
            groups: [],
            activeGroupId: null,
            currentGroupId: null,
            playbackSpeed: 1,
            transitionType: 'fade',
            currentVideoIndex: 0,
            isPlaying: false,
            mouseTimer: null,
            videosPath: '/videos/',
            musicsPath: '/musics/',
            loopPlayback: true,
            audioSource: 'video',
            selectedMusicId: null,
            musicList: [],
            settings: {
                playbackSpeed: 1,
                transitionType: 'fade',
                loopPlayback: true,
                audioSource: 'video',
                selectedMusicId: null
            }
        };

        // DOM elements
        const viewModeBtn = document.getElementById('viewModeBtn');
        const adminModeBtn = document.getElementById('adminModeBtn');
        const viewMode = document.getElementById('viewMode');
        const adminMode = document.getElementById('adminMode');
        const newGroupName = document.getElementById('newGroupName');
        const createGroupBtn = document.getElementById('createGroupBtn');
        const groupSelect = document.getElementById('groupSelect');
        const activeGroupSelect = document.getElementById('activeGroupSelect');
        const setActiveGroupBtn = document.getElementById('setActiveGroupBtn');
        const deleteGroupBtn = document.getElementById('deleteGroupBtn');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const uploadStatus = document.getElementById('uploadStatus');
        const videoList = document.getElementById('videoList');
        const noGroupSelected = document.getElementById('noGroupSelected');
        const emptyGroupMessage = document.getElementById('emptyGroupMessage');
        const currentGroupName = document.getElementById('currentGroupName');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const transitionType = document.getElementById('transitionType');
        const loopPlayback = document.getElementById('loopPlayback');
        const useVideoAudio = document.getElementById('useVideoAudio');
        const useBackgroundMusic = document.getElementById('useBackgroundMusic');
        const backgroundMusicSelector = document.getElementById('backgroundMusicSelector');
        const musicSelect = document.getElementById('musicSelect');
        const startPlaybackBtn = document.getElementById('startPlaybackBtn');
        const fullscreenPlayer = document.getElementById('fullscreenPlayer');
        const videoPlayer = document.getElementById('videoPlayer');
        const audioPlayer = document.getElementById('audioPlayer');
        const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');
        const toggleMuteBtn = document.getElementById('toggleMuteBtn');
        const currentVideoInfo = document.getElementById('currentVideoInfo');
        const saveDataBtn = document.getElementById('saveDataBtn');
        const loadDataBtn = document.getElementById('loadDataBtn');
        const saveStatus = document.getElementById('saveStatus');
        const controlOverlay = document.getElementById('controlOverlay');
        const audioUploadArea = document.getElementById('audioUploadArea');
        const audioFileInput = document.getElementById('audioFileInput');
        const audioUploadProgress = document.getElementById('audioUploadProgress');
        const audioProgressBar = document.getElementById('audioProgressBar');
        const audioUploadStatus = document.getElementById('audioUploadStatus');
        const musicList = document.getElementById('musicList');

        // Switch between modes
        viewModeBtn.addEventListener('click', () => {
            viewMode.classList.remove('hidden');
            viewMode.classList.add('flex');
            adminMode.classList.add('hidden');
            viewModeBtn.classList.add('bg-indigo-700');
            viewModeBtn.classList.remove('bg-indigo-500');
            adminModeBtn.classList.add('bg-indigo-500');
            adminModeBtn.classList.remove('bg-indigo-700');
            updateActiveGroupSelect();
            loadSettings();
        });

        adminModeBtn.addEventListener('click', () => {
            adminMode.classList.remove('hidden');
            viewMode.classList.add('hidden');
            viewMode.classList.remove('flex');
            adminModeBtn.classList.add('bg-indigo-700');
            adminModeBtn.classList.remove('bg-indigo-500');
            viewModeBtn.classList.add('bg-indigo-500');
            viewModeBtn.classList.remove('bg-indigo-700');
        });

        // Create new group
        createGroupBtn.addEventListener('click', () => {
            let name = newGroupName.value.trim();
            if (!name) {
                // Generate default name if empty
                const groupCount = appState.groups.length + 1;
                const currentDate = new Date();
                const dateStr = currentDate.toLocaleDateString();
                name = `Video Sequence ${groupCount} - ${dateStr}`;
            }

            const groupId = 'group_' + Date.now();
            appState.groups.push({
                id: groupId,
                name: name,
                videos: []
            });
            newGroupName.value = '';
            updateGroupSelects();
            showNotification('Группа успешно создана', 'success');
        });

        // Select group
        groupSelect.addEventListener('change', () => {
            appState.currentGroupId = groupSelect.value;
            updateVideoList();
        });

        // Set active group
        setActiveGroupBtn.addEventListener('click', () => {
            if (appState.currentGroupId) {
                appState.activeGroupId = appState.currentGroupId;
                updateActiveGroupSelect();
                showNotification('Набор активных групп', 'success');
            } else {
                showNotification('Пожалуйста, выберите группу', 'error');
            }
        });

        // Delete group
        deleteGroupBtn.addEventListener('click', () => {
            if (appState.currentGroupId) {
                if (confirm('Вы уверены, что хотите удалить эту группу?')) {
                    appState.groups = appState.groups.filter(group => group.id !== appState.currentGroupId);
                    if (appState.activeGroupId === appState.currentGroupId) {
                        appState.activeGroupId = null;
                    }
                    appState.currentGroupId = null;
                    updateGroupSelects();
                    updateVideoList();
                    showNotification('Группа удалена', 'success');
                }
            } else {
                showNotification('Пожалуйста, выберите группу для удаления', 'error');
            }
        });

        // Video upload
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            if (appState.currentGroupId) {
                handleFiles(e.dataTransfer.files);
            } else {
                showNotification('Пожалуйста, сначала выберите группу', 'error');
            }
        });

        fileInput.addEventListener('change', () => {
            if (appState.currentGroupId) {
                handleFiles(fileInput.files);
            } else {
                showNotification('Пожалуйста, сначала выберите группу', 'error');
                fileInput.value = '';
            }
        });

        // Audio upload
        audioUploadArea.addEventListener('click', () => {
            audioFileInput.click();
        });

        audioUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            audioUploadArea.classList.add('drag-over');
        });

        audioUploadArea.addEventListener('dragleave', () => {
            audioUploadArea.classList.remove('drag-over');
        });

        audioUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            audioUploadArea.classList.remove('drag-over');
            handleAudioFiles(e.dataTransfer.files);
        });

        audioFileInput.addEventListener('change', () => {
            handleAudioFiles(audioFileInput.files);
        });

        // Handle uploaded files
        function handleFiles(files) {
            if (files.length === 0) return;

            uploadProgress.classList.remove('hidden');
            let totalFiles = files.length;
            let processedFiles = 0;

            Array.from(files).forEach(file => {
                if (!file.type.startsWith('video/')) {
                    processedFiles++;
                    updateUploadProgress(processedFiles, totalFiles);
                    return;
                }

                const videoId = 'video_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
                const fileName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');
                const serverPath = appState.videosPath + fileName;

                // Create FormData for file upload
                const formData = new FormData();
                formData.append('video', file);

                // Upload file to server
                fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('File upload error');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Create temporary URL for thumbnail
                        const tempURL = URL.createObjectURL(file);
                        const video = document.createElement('video');
                        video.src = tempURL;

                        video.addEventListener('loadeddata', () => {
                            // Create canvas for frame capture
                            const canvas = document.createElement('canvas');
                            canvas.width = 160;
                            canvas.height = 90;
                            const ctx = canvas.getContext('2d');

                            // Seek to 1 second or middle for short videos
                            video.currentTime = Math.min(1, video.duration / 2);

                            video.addEventListener('seeked', () => {
                                // Draw frame to canvas
                                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                                // Get thumbnail as Data URL
                                const thumbnailUrl = canvas.toDataURL('image/jpeg');

                                // Add video to current group
                                const currentGroup = appState.groups.find(group => group.id === appState.currentGroupId);
                                if (currentGroup) {
                                    currentGroup.videos.push({
                                        id: videoId,
                                        name: file.name,
                                        path: serverPath,
                                        thumbnail: thumbnailUrl,
                                        duration: video.duration
                                    });
                                }

                                // Release temporary URL
                                URL.revokeObjectURL(tempURL);

                                processedFiles++;
                                updateUploadProgress(processedFiles, totalFiles);

                                if (processedFiles === totalFiles) {
                                    setTimeout(() => {
                                        uploadProgress.classList.add('hidden');
                                        fileInput.value = '';
                                        updateVideoList();
                                    }, 500);
                                }
                            });
                        });
                    })
                    .catch(error => {
                        showNotification('Upload error: ' + error.message, 'error');
                        processedFiles++;
                        updateUploadProgress(processedFiles, totalFiles);
                    });
            });
        }

        // Handle audio files
        function handleAudioFiles(files) {
            if (files.length === 0) return;

            audioUploadProgress.classList.remove('hidden');
            let totalFiles = files.length;
            let processedFiles = 0;

            Array.from(files).forEach(file => {
                if (!file.type.startsWith('audio/')) {
                    processedFiles++;
                    updateAudioUploadProgress(processedFiles, totalFiles);
                    return;
                }

                const audioId = 'audio_' + Date.now() + '_' + Math.floor(Math.random() * 1000);
                const fileName = file.name.replace(/[^a-zA-Z0-9._-]/g, '_');
                const serverPath = appState.musicsPath + fileName;

                // Create FormData for file upload
                const formData = new FormData();
                formData.append('audio', file);

                // Upload file to server
                fetch('/api/upload-audio', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Audio upload error');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Add audio to music list
                        appState.musicList.push({
                            id: audioId,
                            name: file.name,
                            path: serverPath
                        });

                        processedFiles++;
                        updateAudioUploadProgress(processedFiles, totalFiles);

                        if (processedFiles === totalFiles) {
                            setTimeout(() => {
                                audioUploadProgress.classList.add('hidden');
                                audioFileInput.value = '';
                                updateMusicList();
                            }, 500);
                        }
                    })
                    .catch(error => {
                        showNotification('Audio upload error: ' + error.message, 'error');
                        processedFiles++;
                        updateAudioUploadProgress(processedFiles, totalFiles);
                    });
            });
        }

        function updateUploadProgress(processed, total) {
            const percent = Math.round((processed / total) * 100);
            progressBar.style.width = percent + '%';
            uploadStatus.textContent = `Загружено: ${percent}%`;
        }

        function updateAudioUploadProgress(processed, total) {
            const percent = Math.round((processed / total) * 100);
            audioProgressBar.style.width = percent + '%';
            audioUploadStatus.textContent = `Загружено: ${percent}%`;
        }

        // Update video list
        function updateVideoList() {
            videoList.innerHTML = '';

            if (!appState.currentGroupId) {
                noGroupSelected.classList.remove('hidden');
                emptyGroupMessage.classList.add('hidden');
                videoList.classList.add('hidden');
                currentGroupName.textContent = 'None Selected';
                return;
            }

            const currentGroup = appState.groups.find(group => group.id === appState.currentGroupId);
            if (!currentGroup) return;

            currentGroupName.textContent = currentGroup.name;
            noGroupSelected.classList.add('hidden');

            if (currentGroup.videos.length === 0) {
                emptyGroupMessage.classList.remove('hidden');
                videoList.classList.add('hidden');
            } else {
                emptyGroupMessage.classList.add('hidden');
                videoList.classList.remove('hidden');

                currentGroup.videos.forEach((video, index) => {
                    const videoItem = document.createElement('div');
                    videoItem.className = 'bg-gray-100 rounded-lg overflow-hidden shadow';
                    videoItem.setAttribute('data-video-id', video.id);
                    videoItem.setAttribute('draggable', 'true');

                    // Format video duration
                    const minutes = Math.floor(video.duration / 60);
                    const seconds = Math.floor(video.duration % 60);
                    const duration = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                    videoItem.innerHTML = `
                            <div class="video-thumbnail">
                                <img src="${video.thumbnail}" alt="${video.name}">
                            </div>
                            <div class="p-3">
                                <p class="text-sm font-medium truncate" title="${video.name}">${video.name}</p>
                                <p class="text-xs text-gray-500">${duration}</p>
                                <div class="flex justify-between mt-2">
                                    <button class="preview-btn text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition">
                                        Предосмотр
                                    </button>
                                    <button class="delete-btn text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition">
                                        Удалить
                                    </button>
                                </div>
                            </div>
                        `;

                    videoList.appendChild(videoItem);

                    // Button handlers
                    const previewBtn = videoItem.querySelector('.preview-btn');
                    const deleteBtn = videoItem.querySelector('.delete-btn');

                    previewBtn.addEventListener('click', () => {
                        previewVideo(video.path);
                    });

                    deleteBtn.addEventListener('click', () => {
                        if (confirm('Вы уверены, что хотите удалить это видео?')) {
                            currentGroup.videos = currentGroup.videos.filter(v => v.id !== video.id);
                            updateVideoList();
                        }
                    });

                    // Drag and drop for reordering
                    videoItem.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', video.id);
                    });
                });

                // Drag and drop handlers
                videoList.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const draggedOver = e.target.closest('[data-video-id]');
                    if (draggedOver) {
                        draggedOver.classList.add('bg-gray-200');
                    }
                });

                videoList.addEventListener('dragleave', (e) => {
                    const draggedOver = e.target.closest('[data-video-id]');
                    if (draggedOver) {
                        draggedOver.classList.remove('bg-gray-200');
                    }
                });

                videoList.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const draggedOver = e.target.closest('[data-video-id]');
                    if (draggedOver) {
                        draggedOver.classList.remove('bg-gray-200');
                        const draggedVideoId = e.dataTransfer.getData('text/plain');
                        const targetVideoId = draggedOver.getAttribute('data-video-id');

                        if (draggedVideoId !== targetVideoId) {
                            const currentGroup = appState.groups.find(group => group.id === appState.currentGroupId);
                            if (currentGroup) {
                                const draggedIndex = currentGroup.videos.findIndex(v => v.id === draggedVideoId);
                                const targetIndex = currentGroup.videos.findIndex(v => v.id === targetVideoId);

                                if (draggedIndex !== -1 && targetIndex !== -1) {
                                    const [movedVideo] = currentGroup.videos.splice(draggedIndex, 1);
                                    currentGroup.videos.splice(targetIndex, 0, movedVideo);
                                    updateVideoList();
                                }
                            }
                        }
                    }
                });
            }
        }

        // Update music list
        function updateMusicList() {
            musicList.innerHTML = '';
            musicSelect.innerHTML = '<option value="">Select background music</option>';

            if (appState.musicList.length === 0) {
                musicList.innerHTML = '<p class="text-sm text-gray-500 text-center py-2">No music files uploaded yet</p>';
                return;
            }

            appState.musicList.forEach(music => {
                // Add to admin music list
                const musicItem = document.createElement('div');
                musicItem.className = 'audio-item';
                if (music.id === appState.selectedMusicId) {
                    musicItem.classList.add('selected');
                }

                musicItem.innerHTML = `
                        <div class="flex-grow">
                            <p class="text-sm font-medium truncate" title="${music.name}">${music.name}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="play-audio-btn text-xs px-2 py-1 bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                </svg>
                            </button>
                            <button class="delete-audio-btn text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    `;

                musicList.appendChild(musicItem);

                // Add to select dropdown
                const option = document.createElement('option');
                option.value = music.id;
                option.textContent = music.name;
                if (music.id === appState.selectedMusicId) {
                    option.selected = true;
                }
                musicSelect.appendChild(option);

                // Button handlers
                const playBtn = musicItem.querySelector('.play-audio-btn');
                const deleteBtn = musicItem.querySelector('.delete-audio-btn');

                playBtn.addEventListener('click', () => {
                    previewAudio(music.path);
                });

                deleteBtn.addEventListener('click', () => {
                    if (confirm('Вы уверены, что хотите удалить этот аудиофайл?')) {
                        appState.musicList = appState.musicList.filter(m => m.id !== music.id);
                        if (appState.selectedMusicId === music.id) {
                            appState.selectedMusicId = null;
                        }
                        updateMusicList();
                    }
                });

                // Select music on click
                musicItem.addEventListener('click', (e) => {
                    if (!e.target.closest('button')) {
                        document.querySelectorAll('.audio-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        musicItem.classList.add('selected');
                        appState.selectedMusicId = music.id;
                        musicSelect.value = music.id;
                    }
                });
            });
        }

        // Preview video
        function previewVideo(url) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';

            modal.innerHTML = `
                    <div class="bg-white rounded-lg overflow-hidden shadow-xl max-w-4xl w-full">
                        <div class="p-4 bg-gray-100 flex justify-between items-center">
                            <h3 class="text-lg font-medium">Предварительный просмотр видео</h3>
                            <button class="close-btn text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="p-4">
                            <video src="${url}" controls class="w-full" style="max-height: 70vh;"></video>
                        </div>
                    </div>
                `;

            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close-btn');
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
        }

        // Preview audio
        function previewAudio(url) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';

            modal.innerHTML = `
                    <div class="bg-white rounded-lg overflow-hidden shadow-xl max-w-md w-full">
                        <div class="p-4 bg-gray-100 flex justify-between items-center">
                            <h3 class="text-lg font-medium">Предварительный просмотр аудио</h3>
                            <button class="close-btn text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <div class="p-6">
                            <audio src="${url}" controls class="w-full"></audio>
                        </div>
                    </div>
                `;

            document.body.appendChild(modal);

            const closeBtn = modal.querySelector('.close-btn');
            const audio = modal.querySelector('audio');

            closeBtn.addEventListener('click', () => {
                audio.pause();
                document.body.removeChild(modal);
            });

            audio.play();
        }

        // Update group selects
        function updateGroupSelects() {
            // Clear selects
            groupSelect.innerHTML = '<option value="">Выберите группу</option>';
            activeGroupSelect.innerHTML = '<option value="">Выберите группу</option>';

            // Fill selects
            appState.groups.forEach(group => {
                const option1 = document.createElement('option');
                option1.value = group.id;
                option1.textContent = group.name;
                if (group.id === appState.currentGroupId) {
                    option1.selected = true;
                }
                groupSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = group.id;
                option2.textContent = group.name;
                if (group.id === appState.activeGroupId) {
                    option2.selected = true;
                }
                activeGroupSelect.appendChild(option2);
            });
        }

        // Update active group select
        function updateActiveGroupSelect() {
            activeGroupSelect.value = appState.activeGroupId || '';
        }

        // Playback settings
        speedSlider.addEventListener('input', () => {
            appState.playbackSpeed = parseFloat(speedSlider.value);
            speedValue.textContent = appState.playbackSpeed + 'x';
            if (videoPlayer.src) {
                videoPlayer.playbackRate = appState.playbackSpeed;
            }
            saveSettings();
        });

        transitionType.addEventListener('change', () => {
            appState.transitionType = transitionType.value;
            saveSettings();
        });

        loopPlayback.addEventListener('change', () => {
            appState.loopPlayback = loopPlayback.checked;
            saveSettings();
        });

        // Audio source selection
        useVideoAudio.addEventListener('change', () => {
            if (useVideoAudio.checked) {
                appState.audioSource = 'video';
                backgroundMusicSelector.classList.add('hidden');
                saveSettings();
            }
        });

        useBackgroundMusic.addEventListener('change', () => {
            if (useBackgroundMusic.checked) {
                appState.audioSource = 'music';
                backgroundMusicSelector.classList.remove('hidden');
                saveSettings();
            }
        });

        musicSelect.addEventListener('change', () => {
            appState.selectedMusicId = musicSelect.value;
            saveSettings();
        });

        // Start playback
        startPlaybackBtn.addEventListener('click', () => {
            if (!appState.activeGroupId) {
                showNotification('Пожалуйста, выберите активную группу', 'error');
                return;
            }

            const activeGroup = appState.groups.find(group => group.id === appState.activeGroupId);
            if (!activeGroup || activeGroup.videos.length === 0) {
                showNotification('В выбранной группе нет видеороликов', 'error');
                return;
            }

            // Show fullscreen player
            fullscreenPlayer.classList.remove('hidden');
            fullscreenPlayer.classList.add('fullscreen');

            // Start playback
            appState.currentVideoIndex = 0;
            appState.isPlaying = true;

            // Setup audio
            setupAudio();

            // Play first video
            playNextVideo();

            // Setup mouse tracking
            setupMouseTracking();
        });

        // Setup audio for playback
        function setupAudio() {
            if (appState.audioSource === 'music' && appState.selectedMusicId) {
                const selectedMusic = appState.musicList.find(music => music.id === appState.selectedMusicId);
                if (selectedMusic) {
                    audioPlayer.src = selectedMusic.path;
                    audioPlayer.loop = true;
                    videoPlayer.muted = true;
                    audioPlayer.play();
                } else {
                    videoPlayer.muted = false;
                }
            } else {
                audioPlayer.src = '';
                videoPlayer.muted = false;
            }
        }

        // Toggle mute
        toggleMuteBtn.addEventListener('click', () => {
            if (appState.audioSource === 'music') {
                audioPlayer.muted = !audioPlayer.muted;
            } else {
                videoPlayer.muted = !videoPlayer.muted;
            }
        });

        // Exit fullscreen
        exitFullscreenBtn.addEventListener('click', () => {
            exitFullscreenMode();
        });

        // Exit fullscreen function
        function exitFullscreenMode() {
            appState.isPlaying = false;
            videoPlayer.pause();
            videoPlayer.src = '';
            audioPlayer.pause();
            audioPlayer.src = '';
            fullscreenPlayer.classList.add('hidden');
            fullscreenPlayer.classList.remove('fullscreen');
            controlOverlay.classList.remove('visible');

            // Clear mouse timer
            if (appState.mouseTimer) {
                clearTimeout(appState.mouseTimer);
                appState.mouseTimer = null;
            }

            // Remove event listeners
            document.removeEventListener('mousemove', handleMouseMove);
            document.removeEventListener('keydown', handleKeyDown);
        }

        // Setup mouse tracking
        function setupMouseTracking() {
            // Show controls on mouse move
            document.addEventListener('mousemove', handleMouseMove);

            // Handle keys (Esc to exit)
            document.addEventListener('keydown', handleKeyDown);

            // Hide controls after delay
            hideControlsAfterDelay();
        }

        function handleMouseMove() {
            // Show controls
            controlOverlay.classList.add('visible');

            // Reset timer and set new one
            hideControlsAfterDelay();
        }

        function hideControlsAfterDelay() {
            // Clear previous timer
            if (appState.mouseTimer) {
                clearTimeout(appState.mouseTimer);
            }

            // Set new timer
            appState.mouseTimer = setTimeout(() => {
                controlOverlay.classList.remove('visible');
            }, 3000);
        }

        function handleKeyDown(e) {
            // Exit on Esc key
            if (e.key === 'Escape') {
                exitFullscreenMode();
            }
        }

        // Video playback
        function playNextVideo() {
            if (!appState.isPlaying) return;

            const activeGroup = appState.groups.find(group => group.id === appState.activeGroupId);
            if (!activeGroup) {
                exitFullscreenMode();
                return;
            }

            // Check if we need to loop
            if (appState.currentVideoIndex >= activeGroup.videos.length) {
                if (appState.loopPlayback) {
                    appState.currentVideoIndex = 0;
                } else {
                    // Finished playing all videos
                    exitFullscreenMode();
                    return;
                }
            }

            const video = activeGroup.videos[appState.currentVideoIndex];


            // Update current video info
            currentVideoInfo.textContent = `${appState.currentVideoIndex + 1}/${activeGroup.videos.length}: ${video.name}`;
            console.log(videoPlayer.duration)

            // Apply transition based on selected type
            videoPlayer.classList.add('opacity-0');

            // Apply different transition effects
            switch(appState.transitionType) {
                case 'fade':
                    videoPlayer.style.transition = 'opacity 0.5s ease-in-out';
                    videoPlayer.style.transform = 'none';
                    break;
                case 'slide-left':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'translateX(-100%)';
                    break;
                case 'slide-right':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'translateX(100%)';
                    break;
                case 'slide-up':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'translateY(-100%)';
                    break;
                case 'slide-down':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'translateY(100%)';
                    break;
                case 'zoom-in':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'scale(0.8)';
                    break;
                case 'zoom-out':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'scale(1.2)';
                    break;
                case 'rotate':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'rotate(-90deg)';
                    break;
                case 'flip':
                    videoPlayer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    videoPlayer.style.transform = 'rotateY(180deg)';
                    break;
                case 'none':
                    videoPlayer.style.transition = 'none';
                    videoPlayer.style.transform = 'none';
                    break;
                default:
                    videoPlayer.style.transition = 'opacity 0.5s ease';
                    videoPlayer.style.transform = 'none';
            }

            setTimeout(() => {
                videoPlayer.src = video.path;
                videoPlayer.playbackRate = appState.playbackSpeed;

                videoPlayer.oncanplay = () => {
                    videoPlayer.classList.remove('opacity-0');

                    switch(appState.transitionType) {
                        case 'slide-left':
                        case 'slide-right':
                        case 'slide-up':
                        case 'slide-down':
                        case 'zoom-in':
                        case 'zoom-out':
                        case 'rotate':
                        case 'flip':
                            videoPlayer.style.transform = 'none';
                            break;
                    }

                    videoPlayer.play();
                };

                videoPlayer.onended = () => {
                    appState.currentVideoIndex++;
                    playNextVideo();
                };
            }, appState.transitionType === 'none' ? 0 : 500);
        }

        // Save settings
        function saveSettings() {
            appState.settings = {
                playbackSpeed: appState.playbackSpeed,
                transitionType: appState.transitionType,
                loopPlayback: appState.loopPlayback,
                audioSource: appState.audioSource,
                selectedMusicId: appState.selectedMusicId
            };

            localStorage.setItem('videoManagerSettings', JSON.stringify(appState.settings));
        }

        // Load settings
        function loadSettings() {
            const savedSettings = localStorage.getItem('videoManagerSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);

                // Apply saved settings
                appState.playbackSpeed = settings.playbackSpeed || 1;
                appState.transitionType = settings.transitionType || 'fade';
                appState.loopPlayback = settings.loopPlayback !== undefined ? settings.loopPlayback : true;
                appState.audioSource = settings.audioSource || 'video';
                appState.selectedMusicId = settings.selectedMusicId || null;

                // Update UI
                speedSlider.value = appState.playbackSpeed;
                speedValue.textContent = appState.playbackSpeed + 'x';
                transitionType.value = appState.transitionType;
                loopPlayback.checked = appState.loopPlayback;

                if (appState.audioSource === 'video') {
                    useVideoAudio.checked = true;
                    backgroundMusicSelector.classList.add('hidden');
                } else {
                    useBackgroundMusic.checked = true;
                    backgroundMusicSelector.classList.remove('hidden');
                }

                if (appState.selectedMusicId) {
                    musicSelect.value = appState.selectedMusicId;
                }
            }
        }

        // Save data
        saveDataBtn.addEventListener('click', async () => {
            try {
                // Prepare data for saving
                const dataToSave = {
                    groups: appState.groups.map(group => ({
                        id: group.id,
                        name: group.name,
                        videos: group.videos.map(video => ({
                            id: video.id,
                            name: video.name,
                            path: video.path,
                            thumbnail: video.thumbnail,
                            duration: video.duration
                        }))
                    })),
                    activeGroupId: appState.activeGroupId,
                    musicList: appState.musicList.map(music => ({
                        id: music.id,
                        name: music.name,
                        path: music.path
                    }))
                };

                // Send data to server
                await fetch('/api/videos', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(dataToSave)
                });

                showSaveStatus('Data saved successfully', 'success');
            } catch (error) {
                showSaveStatus('Error saving data: ' + error.message, 'error');
            }
        });

        // Load data
        loadDataBtn.addEventListener('click', async () => {
            try {
                const response = await fetch('/api/videos');
                const data = await response.json();

                // Update app state
                appState.groups = data.groups || [];
                appState.activeGroupId = data.activeGroupId || null;
                appState.currentGroupId = null;
                appState.musicList = data.musicList || [];

                // Update UI
                updateGroupSelects();
                updateVideoList();
                updateActiveGroupSelect();
                updateMusicList();

                showSaveStatus('Data loaded successfully', 'success');
            } catch (error) {
                showSaveStatus('Error loading data: ' + error.message, 'error');
            }
        });

        function showSaveStatus(message, type) {
            saveStatus.textContent = message;
            saveStatus.className = 'mt-4 text-sm';

            if (type === 'success') {
                saveStatus.classList.add('text-green-600');
            } else {
                saveStatus.classList.add('text-red-600');
            }

            saveStatus.classList.remove('hidden');

            setTimeout(() => {
                saveStatus.classList.add('hidden');
            }, 3000);
        }

        // Notifications
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg transition-opacity duration-300 z-50`;

            if (type === 'success') {
                notification.classList.add('bg-green-500', 'text-white');
            } else {
                notification.classList.add('bg-red-500', 'text-white');
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('opacity-0');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Initialize
        adminModeBtn.click();
        loadSettings();
    });
</script>



</body></html>